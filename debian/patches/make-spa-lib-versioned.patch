From: Wim Taymans <wtaymans@redhat.com>
Date: Mon, 13 Aug 2018 16:14:14 +0200
Subject: make spa-lib versioned

Fixes #60
---
 meson.build           | 1 +
 pkgconfig/meson.build | 8 ++++----
 spa/lib/meson.build   | 2 +-
 spa/meson.build       | 1 +
 4 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/meson.build b/meson.build
index d4b8b6e..4a87145 100644
--- a/meson.build
+++ b/meson.build
@@ -17,6 +17,7 @@ else
   pipewire_version_nano = 0
 endif
 
+spaversion = '0.1'
 apiversion = '0.2'
 soversion = 1
 libversion = '@0@.@1@.0'.format(soversion, pipewire_version_minor.to_int() * 100 + pipewire_version_micro.to_int())
diff --git a/pkgconfig/meson.build b/pkgconfig/meson.build
index babd289..9d57578 100644
--- a/pkgconfig/meson.build
+++ b/pkgconfig/meson.build
@@ -11,13 +11,13 @@ pkgconf.set('VERSION', pipewire_version)
 pkg_install_dir = '@0@/pkgconfig'.format(get_option('libdir'))
 
 pkg_files = [
-  'libpipewire',
-  'libspa',
+  [ 'libpipewire', apiversion ],
+  [ 'libspa', spaversion ],
 ]
 
 foreach p : pkg_files
-  infile = p + '.pc.in'
-  outfile = p + '-@0@.pc'.format(apiversion)
+  infile = p.get(0) + '.pc.in'
+  outfile = p.get(0) + '-@0@.pc'.format(p.get(1))
   configure_file(input : infile,
     output : outfile,
     configuration : pkgconf,
diff --git a/spa/lib/meson.build b/spa/lib/meson.build
index 8f85ae4..7914759 100644
--- a/spa/lib/meson.build
+++ b/spa/lib/meson.build
@@ -8,7 +8,7 @@ install_headers(spalib_headers, subdir : 'spa/lib')
 spalib_sources = ['debug.c',
                   'pod.c' ]
 
-spalib = shared_library('spa-lib',
+spalib = shared_library('spa-lib-@0@'.format(spaversion),
                          spalib_sources,
                          version : libversion,
                          soversion : soversion,
diff --git a/spa/meson.build b/spa/meson.build
index 74e92d2..6a76c27 100644
--- a/spa/meson.build
+++ b/spa/meson.build
@@ -1,5 +1,6 @@
 #project('spa', 'c')
 
+
 alsa_dep = dependency('alsa')
 v4l2_dep = dependency('libv4l2')
 x11_dep = dependency('x11', required : false)
